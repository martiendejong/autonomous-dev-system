---
name: github-workflow
description: Handle GitHub pull request workflows including creating PRs, reviewing code, checking PR comments, and managing PR lifecycle. Use when working with pull requests, code reviews, or GitHub operations.
allowed-tools: Bash, Read, Write, Grep
user-invocable: true
---

# GitHub PR Workflow

**Purpose:** Manage complete GitHub pull request lifecycle from creation to merge.

## Creating Pull Requests

### Standard PR Creation

```bash
cd C:/Projects/worker-agents/agent-XXX/<repo>

# Create PR with proper format
gh pr create --title "<type>: <brief description>" --body "$(cat <<'EOF'
## Summary
<1-3 bullet points explaining what changed and why>

## Changes
- <specific change 1>
- <specific change 2>
- <specific change 3>

## Testing
- <testing performed>
- <verification steps>

## Related Issues
Closes #<issue-number> (if applicable)

ü§ñ Generated by Claude Code Agent
EOF
)"
```

### PR Title Conventions

**Format:** `<type>: <description>`

**Types:**
- `feat:` - New feature
- `fix:` - Bug fix
- `refactor:` - Code restructuring (no behavior change)
- `perf:` - Performance improvement
- `docs:` - Documentation only
- `test:` - Adding or updating tests
- `chore:` - Maintenance tasks
- `style:` - Code formatting (no logic change)

**Examples:**
```
feat: Add user token balance display
fix: Correct API path duplication in company documents
refactor: Migrate daily token terminology to monthly
```

### Cross-Repo Dependency Headers

If PR depends on another repo's PR, add to body:

```markdown
## ‚ö†Ô∏è DEPENDENCY ALERT

This PR depends on:
- myframework PR #XX - <description>

**Merge order:** myframework first, then this PR
```

## Reviewing Pull Requests

### Get PR Details

```bash
# View PR
gh pr view <number> --repo <owner>/<repo>

# View PR diff
gh pr diff <number> --repo <owner>/<repo>

# View PR checks
gh pr checks <number> --repo <owner>/<repo>
```

### Check PR Comments and Feedback

**Use custom skill:**
```bash
# This invokes the /pr-comments skill
claude /pr-comments <pr-number>
```

**Or manually:**
```bash
gh api repos/<owner>/<repo>/pulls/<number>/comments
```

### Review PR Code

**Use custom skill:**
```bash
# This invokes the /review skill (standards-based code review)
claude /review
```

**Manual review checklist:**
- ‚úÖ Code follows project conventions
- ‚úÖ No hardcoded secrets or credentials
- ‚úÖ Error handling appropriate
- ‚úÖ Tests included (if applicable)
- ‚úÖ No console.log or debug statements in production code
- ‚úÖ Documentation updated
- ‚úÖ No unnecessary complexity

### Security Review

**Use custom skill:**
```bash
# This invokes the /security-review skill
claude /security-review
```

**Manual security checklist:**
- ‚úÖ No SQL injection vulnerabilities
- ‚úÖ No XSS vulnerabilities
- ‚úÖ No command injection
- ‚úÖ Proper input validation
- ‚úÖ No sensitive data in logs
- ‚úÖ Authentication/authorization correct

## Merging Pull Requests

### Pre-Merge Checklist

```bash
# 1. Check PR status
gh pr view <number> --repo <owner>/<repo>

# 2. Verify CI checks passing
gh pr checks <number> --repo <owner>/<repo>

# 3. Check for conflicts
gh pr status --repo <owner>/<repo>

# 4. Verify approvals (if required)
```

### Merge PR

```bash
# Merge with squash (recommended for feature branches)
gh pr merge <number> --squash --delete-branch --repo <owner>/<repo>

# Merge with merge commit (for develop ‚Üí main)
gh pr merge <number> --merge --delete-branch --repo <owner>/<repo>

# Merge with rebase (for linear history)
gh pr merge <number> --rebase --delete-branch --repo <owner>/<repo>
```

### Post-Merge Cleanup

```bash
# 1. Switch base repo to develop
cd C:/Projects/<repo>
git checkout develop
git pull origin develop

# 2. Delete local feature branch (if exists)
git branch -d <branch-name>

# 3. Prune worktrees
git worktree prune
```

## Handling PR Failures

### CI Build Failures

```bash
# View failure logs
gh run view <run-id> --log-failed --repo <owner>/<repo>

# Re-run failed jobs
gh run rerun <run-id> --repo <owner>/<repo>
```

**If systematic CI failures (e.g., EnableWindowsTargeting issue):**
- See `C:/scripts/ci-cd-troubleshooting.md`
- May need to apply fix to ALL relevant branches

### Merge Conflicts

```bash
# Update branch with latest develop
cd C:/Projects/worker-agents/agent-XXX/<repo>
git fetch origin develop
git merge origin/develop

# Resolve conflicts
# ... manual conflict resolution ...

git add .
git commit -m "chore: Resolve merge conflicts with develop"
git push origin <branch-name>
```

### Addressing PR Feedback

```bash
# 1. Make requested changes in worktree
cd C:/Projects/worker-agents/agent-XXX/<repo>

# 2. Commit changes
git add <files>
git commit -m "fix: Address PR feedback - <description>"

# 3. Push updates
git push origin <branch-name>

# 4. Comment on PR
gh pr comment <number> --body "‚úÖ Feedback addressed. Changes pushed." --repo <owner>/<repo>
```

## PR Status Tracking

### List Open PRs

```bash
# All open PRs for repo
gh pr list --repo <owner>/<repo>

# Your PRs
gh pr list --author "@me" --repo <owner>/<repo>

# PRs by agent
gh pr list --author "claude-agent" --repo <owner>/<repo>
```

### Check PR Status

```bash
# Quick status
gh pr status --repo <owner>/<repo>

# Detailed view
gh pr view <number> --repo <owner>/<repo>
```

## Working with Draft PRs

### Create Draft PR

```bash
gh pr create --draft --title "<title>" --body "<body>" --repo <owner>/<repo>
```

### Mark PR Ready for Review

```bash
gh pr ready <number> --repo <owner>/<repo>
```

### Convert to Draft

```bash
gh pr edit <number> --draft --repo <owner>/<repo>
```

## PR Templates

### Feature PR Template

```markdown
## Summary
Implements <feature name> to <solve problem>

## Changes
- Added <component/service/feature>
- Updated <existing functionality>
- Modified <configuration/setup>

## Testing
- Unit tests: <coverage>
- Integration tests: <scenarios>
- Manual testing: <steps performed>

## Screenshots (if UI changes)
<attach screenshots>

## Related Issues
Closes #<issue>

ü§ñ Generated by Claude Code Agent
```

### Bug Fix PR Template

```markdown
## Problem
<Description of bug and impact>

## Root Cause
<Technical explanation of what caused the bug>

## Solution
<How this PR fixes the issue>

## Changes
- Fixed <specific issue>
- Added <safeguard/test>

## Testing
- Verified fix with <test case>
- Regression testing: <results>

## Related Issues
Fixes #<issue>

ü§ñ Generated by Claude Code Agent
```

### Refactor PR Template

```markdown
## Motivation
<Why this refactor was needed>

## Changes
- Refactored <component/pattern>
- Improved <aspect>
- Simplified <complexity>

## Behavior
‚úÖ No behavior changes
OR
‚ö†Ô∏è Behavior changes: <list changes>

## Testing
- All existing tests pass
- No regression detected

ü§ñ Generated by Claude Code Agent
```

## Reference

### Custom Skills
- `/pr-comments <number>` - Get PR comments and feedback
- `/review` - Standards-based code review
- `/security-review` - Security vulnerability scan

### Documentation
- `C:/scripts/git-workflow.md` - Git-flow branch strategy
- `C:/scripts/ci-cd-troubleshooting.md` - CI/CD issue resolution
- `C:/scripts/_machine/pr-dependencies.md` - Cross-repo PR tracking

### GitHub CLI Reference
```bash
gh pr create   # Create PR
gh pr view     # View PR details
gh pr diff     # View PR changes
gh pr checks   # View CI status
gh pr merge    # Merge PR
gh pr comment  # Add comment
gh pr list     # List PRs
gh pr status   # PR status summary
```

## Best Practices

‚úÖ **DO:**
- Create PRs from worktrees, never from C:/Projects/<repo>
- Include comprehensive PR descriptions
- Reference related issues
- Add dependency alerts for cross-repo PRs
- Run tests before creating PR
- Respond to PR feedback promptly
- Clean up after merge

‚ùå **DON'T:**
- Create PR without releasing worktree first (VIOLATION)
- Use vague PR titles ("fix stuff", "updates")
- Merge without CI checks passing
- Force push to PRs under review
- Delete branches with unmerged PRs
- Ignore PR feedback
