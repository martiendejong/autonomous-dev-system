---
name: pr-dependencies
description: Manage cross-repository PR dependencies between myframework framework and myproject. Track dependency chains, enforce merge order, and prevent deployment issues. Use when creating PRs that depend on other repos.
allowed-tools: Bash, Read, Write, Grep
user-invocable: true
---

# Cross-Repo PR Dependencies

**Purpose:** Track and manage dependencies between myframework (framework) and myproject (application) pull requests.

## Dependency Pattern

### Architecture
```
myframework (Framework)
    ‚Üì (depends on)
myproject (Application)
```

**Rule:** myframework changes MUST be merged and deployed BEFORE dependent myproject changes.

## Identifying Dependencies

### When Does a Dependency Exist?

**A myproject PR depends on myframework PR if:**
- Uses new myframework interfaces or methods
- Requires updated myframework NuGet package
- References new myframework configuration options
- Relies on myframework bug fixes or behavior changes

**Examples:**
```
‚úÖ Dependency exists:
- myproject PR uses ImyframeworkAIService.NewMethod()
- myframework PR #XX added NewMethod()
- Merge order: myframework #XX first, then myproject

‚úÖ Dependency exists:
- myproject PR fixes bug by using myframework's corrected logic
- myframework PR #YY fixed the underlying issue
- Merge order: myframework #YY first, then myproject

‚ùå No dependency:
- myproject PR only changes frontend UI
- myframework PR adds unrelated feature
- Can merge independently
```

## Creating Dependent PRs

### Step 1: Create myframework PR First

```bash
# Work in myframework worktree
cd C:/Projects/worker-agents/agent-XXX/myframework

# Make changes, commit, push
git add .
git commit -m "feat: Add new LLM method for X"
git push origin agent-XXX-llm-feature

# Create PR
gh pr create --title "feat: Add new LLM method" --body "..." --repo owner/myframework
```

**Note the PR number** (e.g., myframework PR #35)

### Step 2: Create myproject PR with Dependency Alert

```bash
# Work in myproject worktree
cd C:/Projects/worker-agents/agent-YYY/myproject

# Make changes, commit, push
git add .
git commit -m "feat: Use new LLM method from myframework"
git push origin agent-YYY-use-llm-feature

# Create PR with dependency header
gh pr create --title "feat: Implement feature using new myframework LLM" --body "$(cat <<'EOF'
## ‚ö†Ô∏è DEPENDENCY ALERT

This PR depends on:
- **myframework PR #35** - Add new LLM method

**Merge order:**
1. Merge myframework PR #35
2. Deploy myframework to NuGet/production
3. Update myproject NuGet reference (if needed)
4. THEN merge this PR

## Summary
Implements <feature> using the new LLM method added in myframework PR #35

## Changes
- <list changes>

ü§ñ Generated by Claude Code Agent
EOF
)" --repo owner/myproject
```

### Step 3: Track Dependency

Add entry to `C:/scripts/_machine/pr-dependencies.md`:

```markdown
## <timestamp> - myframework PR #35 ‚Üí myproject PR #93

**myframework PR:** #35 - Add new LLM method
**URL:** https://github.com/owner/myframework/pull/35
**Status:** OPEN

**Dependent myproject PR:** #93 - Implement feature using new LLM
**URL:** https://github.com/owner/myproject/pull/93
**Status:** OPEN (BLOCKED on myframework #35)

**Merge order:**
1. myframework #35
2. Deploy/update
3. myproject #93

**Created by:** agent-XXX
**Date:** <ISO timestamp>
```

## Tracking Dependencies

### Check Dependency Status

```bash
# View dependency tracking file
cat C:/scripts/_machine/pr-dependencies.md

# Check myframework PR status
gh pr view <number> --repo owner/myframework

# Check myproject PR status
gh pr view <number> --repo owner/myproject
```

### Update Dependency Status

When myframework PR merges:

```markdown
## <timestamp> - myframework PR #35 ‚Üí myproject PR #93

**myframework PR:** #35 - Add new LLM method
**URL:** https://github.com/owner/myframework/pull/35
**Status:** ‚úÖ MERGED (2026-01-12)

**Dependent myproject PR:** #93 - Implement feature using new LLM
**URL:** https://github.com/owner/myproject/pull/93
**Status:** READY TO MERGE (dependency satisfied)

**Resolution:**
- myframework #35 merged on 2026-01-12
- NuGet package updated (if applicable)
- myproject PR #93 ready for merge
```

## Merge Order Enforcement

### Before Merging myproject PR

**MANDATORY CHECKS:**

```bash
# 1. Verify myframework PR merged
gh pr view <myframework-pr-number> --repo owner/myframework --json state

# 2. Check dependency tracking
grep "PR #<myproject-pr-number>" C:/scripts/_machine/pr-dependencies.md

# 3. Verify NuGet package updated (if needed)
# Check project.csproj for latest myframework version
```

**If myframework PR NOT merged yet:**
```
üö® MERGE ORDER VIOLATION PREVENTED üö®

Cannot merge myproject PR #93 because:
- Depends on myframework PR #35
- myframework PR #35 is still OPEN

Wait for myframework PR #35 to merge first.
```

### Safe Merge Procedure

```bash
# 1. Confirm myframework PR merged
gh pr view <myframework-pr> --repo owner/myframework

# 2. Update NuGet reference (if needed)
cd C:/Projects/worker-agents/agent-XXX/myproject
# Update .csproj with new myframework package version
dotnet restore

# 3. Test myproject with new myframework version
dotnet build

# 4. If tests pass, merge myproject PR
gh pr merge <number> --squash --delete-branch --repo owner/myproject

# 5. Update dependency tracking (mark RESOLVED)
```

## Dependency Tracking File Format

### Active Dependency

```markdown
## ACTIVE DEPENDENCIES

### 2026-01-12 20:00 - myframework #35 ‚Üí myproject #93
- **myframework:** #35 (OPEN) - Add new LLM method
- **myproject:** #93 (BLOCKED) - Feature using new method
- **Status:** Waiting for myframework #35 merge
- **Agent:** agent-001

### 2026-01-12 21:00 - myframework #36 ‚Üí myproject #94
- **myframework:** #36 (MERGED ‚úÖ) - Fix token counting
- **myproject:** #94 (READY) - Use fixed token counter
- **Status:** myframework merged, myproject ready to merge
- **Agent:** agent-002
```

### Resolved Dependencies

```markdown
## RESOLVED DEPENDENCIES

### 2026-01-12 - myframework #33 ‚Üí myproject #91
- **myframework:** #33 (MERGED ‚úÖ) - Config templates
- **myproject:** #91 (MERGED ‚úÖ) - Use config templates
- **Resolved:** 2026-01-12 18:00
- **Agent:** agent-006
```

## Common Scenarios

### Scenario 1: Framework Feature ‚Üí Application Usage

```
1. myframework PR #XX - Add new feature to framework
2. myproject PR #YY - Use new framework feature

Merge order: myframework #XX ‚Üí myproject #YY
```

### Scenario 2: Framework Bug Fix ‚Üí Application Fix

```
1. myframework PR #XX - Fix bug in core logic
2. myproject PR #YY - Remove workaround, use fixed logic

Merge order: myframework #XX ‚Üí myproject #YY
```

### Scenario 3: Breaking Change

```
1. myframework PR #XX - Breaking API change
2. myproject PR #YY - Update to new API

‚ö†Ô∏è CRITICAL: Must merge together, coordinate deployment
Merge order: myframework #XX ‚Üí Deploy ‚Üí myproject #YY ‚Üí Deploy
```

### Scenario 4: Optional Enhancement

```
1. myframework PR #XX - Add optional feature
2. myproject PR #YY - Optionally use feature (with fallback)

Merge order: Can merge independently OR myframework first for full functionality
```

## Conflict Detection

### Before Creating Dependent PR

```bash
# Check for existing dependencies on same myframework PR
grep "myframework PR #XX" C:/scripts/_machine/pr-dependencies.md
```

**If multiple myproject PRs depend on same myframework PR:**
- Coordinate merge timing
- Update all dependent PRs after myframework merges
- Document in pr-dependencies.md

## Reference Files

- Dependency tracking: `C:/scripts/_machine/pr-dependencies.md`
- Git workflow: `C:/scripts/git-workflow.md`
- PR creation: See github-workflow Skill

## Best Practices

‚úÖ **DO:**
- Always check if PR needs myframework changes first
- Create myframework PR before myproject PR
- Add dependency alert to PR description
- Track dependencies in pr-dependencies.md
- Update tracking when PRs merge
- Verify myframework merged before merging myproject

‚ùå **DON'T:**
- Merge myproject PR before dependent myframework PR
- Forget to document dependencies
- Create breaking changes without coordination
- Assume NuGet updates happen automatically
- Skip verification checks

## Alert Template

**For PR descriptions:**

```markdown
## ‚ö†Ô∏è DEPENDENCY ALERT

This PR depends on:
- **myframework PR #XX** - <description>
  - URL: https://github.com/owner/myframework/pull/XX
  - Status: <OPEN/MERGED>

**Merge order:**
1. Merge myframework PR #XX
2. [Optional: Deploy myframework, update NuGet]
3. Merge this PR

**Why dependency exists:**
<Brief explanation of why this PR needs myframework changes>
```

## Troubleshooting

**"myproject build fails after myframework merge":**
- Update NuGet package reference
- Run `dotnet restore` and `dotnet build`
- Check for API changes in myframework PR

**"Forgot to document dependency":**
- Add entry to pr-dependencies.md now
- Update PR description with dependency alert
- Comment on PR about merge order

**"Multiple PRs waiting on same myframework PR":**
- List all dependent PRs in dependency tracking
- Merge myframework PR first
- Then merge myproject PRs in sequence
- Test each merge before proceeding
