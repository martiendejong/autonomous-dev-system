---
name: pr-dependencies
description: Manage cross-repository PR dependencies between Hazina framework and client-manager. Track dependency chains, enforce merge order, and prevent deployment issues. Use when creating PRs that depend on other repos.
allowed-tools: Bash, Read, Write, Grep
user-invocable: true
---

# Cross-Repo PR Dependencies

**Purpose:** Track and manage dependencies between Hazina (framework) and client-manager (application) pull requests.

## Dependency Pattern

### Architecture
```
Hazina (Framework)
    ‚Üì (depends on)
client-manager (Application)
```

**Rule:** Hazina changes MUST be merged and deployed BEFORE dependent client-manager changes.

## Identifying Dependencies

### When Does a Dependency Exist?

**A client-manager PR depends on Hazina PR if:**
- Uses new Hazina interfaces or methods
- Requires updated Hazina NuGet package
- References new Hazina configuration options
- Relies on Hazina bug fixes or behavior changes

**Examples:**
```
‚úÖ Dependency exists:
- client-manager PR uses IHazinaAIService.NewMethod()
- Hazina PR #XX added NewMethod()
- Merge order: Hazina #XX first, then client-manager

‚úÖ Dependency exists:
- client-manager PR fixes bug by using Hazina's corrected logic
- Hazina PR #YY fixed the underlying issue
- Merge order: Hazina #YY first, then client-manager

‚ùå No dependency:
- client-manager PR only changes frontend UI
- Hazina PR adds unrelated feature
- Can merge independently
```

## Creating Dependent PRs

### Step 1: Create Hazina PR First

```bash
# Work in Hazina worktree
cd C:/Projects/worker-agents/agent-XXX/hazina

# Make changes, commit, push
git add .
git commit -m "feat: Add new LLM method for X"
git push origin agent-XXX-llm-feature

# Create PR
gh pr create --title "feat: Add new LLM method" --body "..." --repo owner/hazina
```

**Note the PR number** (e.g., Hazina PR #35)

### Step 2: Create client-manager PR with Dependency Alert

```bash
# Work in client-manager worktree
cd C:/Projects/worker-agents/agent-YYY/client-manager

# Make changes, commit, push
git add .
git commit -m "feat: Use new LLM method from Hazina"
git push origin agent-YYY-use-llm-feature

# Create PR with dependency header
gh pr create --title "feat: Implement feature using new Hazina LLM" --body "$(cat <<'EOF'
## ‚ö†Ô∏è DEPENDENCY ALERT

This PR depends on:
- **Hazina PR #35** - Add new LLM method

**Merge order:**
1. Merge Hazina PR #35
2. Deploy Hazina to NuGet/production
3. Update client-manager NuGet reference (if needed)
4. THEN merge this PR

## Summary
Implements <feature> using the new LLM method added in Hazina PR #35

## Changes
- <list changes>

ü§ñ Generated by Claude Code Agent
EOF
)" --repo owner/client-manager
```

### Step 3: Track Dependency

Add entry to `C:/scripts/_machine/pr-dependencies.md`:

```markdown
## <timestamp> - Hazina PR #35 ‚Üí client-manager PR #93

**Hazina PR:** #35 - Add new LLM method
**URL:** https://github.com/owner/hazina/pull/35
**Status:** OPEN

**Dependent client-manager PR:** #93 - Implement feature using new LLM
**URL:** https://github.com/owner/client-manager/pull/93
**Status:** OPEN (BLOCKED on Hazina #35)

**Merge order:**
1. Hazina #35
2. Deploy/update
3. client-manager #93

**Created by:** agent-XXX
**Date:** <ISO timestamp>
```

## Tracking Dependencies

### Check Dependency Status

```bash
# View dependency tracking file
cat C:/scripts/_machine/pr-dependencies.md

# Check Hazina PR status
gh pr view <number> --repo owner/hazina

# Check client-manager PR status
gh pr view <number> --repo owner/client-manager
```

### Update Dependency Status

When Hazina PR merges:

```markdown
## <timestamp> - Hazina PR #35 ‚Üí client-manager PR #93

**Hazina PR:** #35 - Add new LLM method
**URL:** https://github.com/owner/hazina/pull/35
**Status:** ‚úÖ MERGED (2026-01-12)

**Dependent client-manager PR:** #93 - Implement feature using new LLM
**URL:** https://github.com/owner/client-manager/pull/93
**Status:** READY TO MERGE (dependency satisfied)

**Resolution:**
- Hazina #35 merged on 2026-01-12
- NuGet package updated (if applicable)
- client-manager PR #93 ready for merge
```

## Merge Order Enforcement

### Before Merging client-manager PR

**MANDATORY CHECKS:**

```bash
# 1. Verify Hazina PR merged
gh pr view <hazina-pr-number> --repo owner/hazina --json state

# 2. Check dependency tracking
grep "PR #<client-manager-pr-number>" C:/scripts/_machine/pr-dependencies.md

# 3. Verify NuGet package updated (if needed)
# Check project.csproj for latest Hazina version
```

**If Hazina PR NOT merged yet:**
```
üö® MERGE ORDER VIOLATION PREVENTED üö®

Cannot merge client-manager PR #93 because:
- Depends on Hazina PR #35
- Hazina PR #35 is still OPEN

Wait for Hazina PR #35 to merge first.
```

### Safe Merge Procedure

```bash
# 1. Confirm Hazina PR merged
gh pr view <hazina-pr> --repo owner/hazina

# 2. Update NuGet reference (if needed)
cd C:/Projects/worker-agents/agent-XXX/client-manager
# Update .csproj with new Hazina package version
dotnet restore

# 3. Test client-manager with new Hazina version
dotnet build

# 4. If tests pass, merge client-manager PR
gh pr merge <number> --squash --delete-branch --repo owner/client-manager

# 5. Update dependency tracking (mark RESOLVED)
```

## Dependency Tracking File Format

### Active Dependency

```markdown
## ACTIVE DEPENDENCIES

### 2026-01-12 20:00 - Hazina #35 ‚Üí client-manager #93
- **Hazina:** #35 (OPEN) - Add new LLM method
- **client-manager:** #93 (BLOCKED) - Feature using new method
- **Status:** Waiting for Hazina #35 merge
- **Agent:** agent-001

### 2026-01-12 21:00 - Hazina #36 ‚Üí client-manager #94
- **Hazina:** #36 (MERGED ‚úÖ) - Fix token counting
- **client-manager:** #94 (READY) - Use fixed token counter
- **Status:** Hazina merged, client-manager ready to merge
- **Agent:** agent-002
```

### Resolved Dependencies

```markdown
## RESOLVED DEPENDENCIES

### 2026-01-12 - Hazina #33 ‚Üí client-manager #91
- **Hazina:** #33 (MERGED ‚úÖ) - Config templates
- **client-manager:** #91 (MERGED ‚úÖ) - Use config templates
- **Resolved:** 2026-01-12 18:00
- **Agent:** agent-006
```

## Common Scenarios

### Scenario 1: Framework Feature ‚Üí Application Usage

```
1. Hazina PR #XX - Add new feature to framework
2. client-manager PR #YY - Use new framework feature

Merge order: Hazina #XX ‚Üí client-manager #YY
```

### Scenario 2: Framework Bug Fix ‚Üí Application Fix

```
1. Hazina PR #XX - Fix bug in core logic
2. client-manager PR #YY - Remove workaround, use fixed logic

Merge order: Hazina #XX ‚Üí client-manager #YY
```

### Scenario 3: Breaking Change

```
1. Hazina PR #XX - Breaking API change
2. client-manager PR #YY - Update to new API

‚ö†Ô∏è CRITICAL: Must merge together, coordinate deployment
Merge order: Hazina #XX ‚Üí Deploy ‚Üí client-manager #YY ‚Üí Deploy
```

### Scenario 4: Optional Enhancement

```
1. Hazina PR #XX - Add optional feature
2. client-manager PR #YY - Optionally use feature (with fallback)

Merge order: Can merge independently OR Hazina first for full functionality
```

## Conflict Detection

### Before Creating Dependent PR

```bash
# Check for existing dependencies on same Hazina PR
grep "Hazina PR #XX" C:/scripts/_machine/pr-dependencies.md
```

**If multiple client-manager PRs depend on same Hazina PR:**
- Coordinate merge timing
- Update all dependent PRs after Hazina merges
- Document in pr-dependencies.md

## Reference Files

- Dependency tracking: `C:/scripts/_machine/pr-dependencies.md`
- Git workflow: `C:/scripts/git-workflow.md`
- PR creation: See github-workflow Skill

## Best Practices

‚úÖ **DO:**
- Always check if PR needs Hazina changes first
- Create Hazina PR before client-manager PR
- Add dependency alert to PR description
- Track dependencies in pr-dependencies.md
- Update tracking when PRs merge
- Verify Hazina merged before merging client-manager

‚ùå **DON'T:**
- Merge client-manager PR before dependent Hazina PR
- Forget to document dependencies
- Create breaking changes without coordination
- Assume NuGet updates happen automatically
- Skip verification checks

## Alert Template

**For PR descriptions:**

```markdown
## ‚ö†Ô∏è DEPENDENCY ALERT

This PR depends on:
- **Hazina PR #XX** - <description>
  - URL: https://github.com/owner/hazina/pull/XX
  - Status: <OPEN/MERGED>

**Merge order:**
1. Merge Hazina PR #XX
2. [Optional: Deploy Hazina, update NuGet]
3. Merge this PR

**Why dependency exists:**
<Brief explanation of why this PR needs Hazina changes>
```

## Troubleshooting

**"client-manager build fails after Hazina merge":**
- Update NuGet package reference
- Run `dotnet restore` and `dotnet build`
- Check for API changes in Hazina PR

**"Forgot to document dependency":**
- Add entry to pr-dependencies.md now
- Update PR description with dependency alert
- Comment on PR about merge order

**"Multiple PRs waiting on same Hazina PR":**
- List all dependent PRs in dependency tracking
- Merge Hazina PR first
- Then merge client-manager PRs in sequence
- Test each merge before proceeding
